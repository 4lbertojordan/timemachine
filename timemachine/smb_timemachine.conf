[global]
   server string = TimeMachine
   workgroup = HOME
   netbios name = TIMEMACHINE
   
   # --- NETWORK SECURITY (Adjust to your network) ---
   # Allow access only from localhost, your LAN, and your VPN (Wireguard/OpenVPN)
   hosts allow = 127.0.0.1 192.168.153.0/24 10.8.0.0/24
   hosts deny = ALL
   
   # --- USER SECURITY ---
   # Block system users from accessing the share
   invalid users = root bin daemon adm sync shutdown halt mail news uucp operator
   
   # For Time Machine it's BETTER to use "never" than "Bad User"
   # Forces Mac to authenticate properly
   map to guest = never
   restrict anonymous = 2
   
   # --- PROTOCOL ---
   server min protocol = SMB2
   server max protocol = SMB3
   security = user
   
   # --- APPLE OPTIMIZATION (DO NOT MODIFY) ---
   vfs objects = catia fruit streams_xattr
   
   fruit:metadata = stream
   fruit:model = MacSamba
   fruit:posix_rename = yes
   fruit:veto_appledouble = no
   fruit:nfs_aces = no
   fruit:wipe_intentionally_left_blank_rfork = yes
   fruit:delete_empty_adfiles = yes
   
   # Performance optimization
   socket options = TCP_NODELAY IPTOS_LOWDELAY
   
   log file = /var/log/samba/log.tm
   max log size = 1000

# --- TIME MACHINE BACKUP SHARE ---
[TimeMachine]
   path = /timemachine
   valid users = jordancodes
   browsable = yes
   writable = yes
   read only = no
   
   # --- FORCED PERMISSIONS (Adjust to your user) ---
   # Ensures all backup files belong to your user
   # Prevents permission issues if you manually delete backups
   force user = jordancodes
   force group = home
   create mask = 0660
   directory mask = 0760
   
   # --- TIME MACHINE MAGIC ---
   fruit:time machine = yes
   # Optional: 850GB backup limit. Remove this line to use all available disk space
   fruit:time machine max size = 850000

   fruit:volume_file_size = yes